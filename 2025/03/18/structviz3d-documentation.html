<hr />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          layout: post
          title: "StructViz3D Complete Documentation"
          date: 2025-03-13
          repository: "yadnyeshkolte/structviz3d-react"
          description: "Full documentation for the StructViz3D library"
          original_file: "Documentation.md"
          permalink: /structviz3d-documentation/
          ---
          # StructViz3D Documentation
</code></pre></div></div>

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#project-overview">Project Overview</a></li>
  <li><a href="#architecture">Architecture</a></li>
  <li><a href="#core-components">Core Components</a>
    <ul>
      <li><a href="#app-component">App Component</a></li>
      <li><a href="#model-viewer">Model Viewer</a></li>
      <li><a href="#file-upload">File Upload</a></li>
    </ul>
  </li>
  <li><a href="#3d-rendering-engine">3D Rendering Engine</a>
    <ul>
      <li><a href="#threejs-integration">Three.js Integration</a></li>
      <li><a href="#model-loading">Model Loading</a></li>
      <li><a href="#scene-management">Scene Management</a></li>
    </ul>
  </li>
  <li><a href="#camera-system">Camera System</a>
    <ul>
      <li><a href="#camera-modes">Camera Modes</a></li>
      <li><a href="#camera-controls">Camera Controls</a></li>
      <li><a href="#camera-state-management">Camera State Management</a></li>
    </ul>
  </li>
  <li><a href="#visualization-features">Visualization Features</a>
    <ul>
      <li><a href="#wireframe-mode">Wireframe Mode</a></li>
      <li><a href="#enhanced-wireframe">Enhanced Wireframe</a></li>
      <li><a href="#color-management">Color Management</a></li>
      <li><a href="#grid-systems">Grid Systems</a></li>
    </ul>
  </li>
  <li><a href="#lighting-system">Lighting System</a>
    <ul>
      <li><a href="#default-lighting-setup">Default Lighting Setup</a></li>
      <li><a href="#lighting-controls">Lighting Controls</a></li>
    </ul>
  </li>
  <li><a href="#user-interface">User Interface</a>
    <ul>
      <li><a href="#viewer-controls">Viewer Controls</a></li>
      <li><a href="#control-panel">Control Panel</a></li>
      <li><a href="#keyboard-shortcuts">Keyboard Shortcuts</a></li>
    </ul>
  </li>
  <li><a href="#interaction-modes">Interaction Modes</a>
    <ul>
      <li><a href="#rotation-mode">Rotation Mode</a></li>
      <li><a href="#drag-mode">Drag Mode</a></li>
      <li><a href="#zoom-functionality">Zoom Functionality</a></li>
    </ul>
  </li>
  <li><a href="#model-orientation">Model Orientation</a>
    <ul>
      <li><a href="#initial-orientation">Initial Orientation</a></li>
      <li><a href="#orientation-controls">Orientation Controls</a></li>
    </ul>
  </li>
  <li><a href="#resource-management">Resource Management</a>
    <ul>
      <li><a href="#loading-optimization">Loading Optimization</a></li>
      <li><a href="#memory-management">Memory Management</a></li>
    </ul>
  </li>
  <li><a href="#performance-optimization">Performance Optimization</a>
    <ul>
      <li><a href="#render-loop">Render Loop</a></li>
      <li><a href="#geometry-management">Geometry Management</a></li>
    </ul>
  </li>
  <li><a href="#responsive-design">Responsive Design</a></li>
  <li><a href="#advanced-features">Advanced Features</a>
    <ul>
      <li><a href="#fullscreen-mode">Fullscreen Mode</a></li>
      <li><a href="#view-presets">View Presets</a></li>
    </ul>
  </li>
  <li><a href="#error-handling">Error Handling</a></li>
  <li><a href="#extension-points">Extension Points</a></li>
  <li><a href="#developer-guide">Developer Guide</a>
    <ul>
      <li><a href="#component-structure">Component Structure</a></li>
    </ul>
  </li>
</ol>

<h2 id="introduction">Introduction</h2>

<p>StructViz3D is a powerful web-based 3D model viewer specifically designed for visualizing structural engineering models. The application allows engineers, architects, and designers to upload, view, and interact with 3D models in a browser environment, eliminating the need for specialized desktop software.</p>

<p>This documentation provides a comprehensive overview of the entire StructViz3D application, covering its architecture, components, features, and implementation details. Whether you’re a user looking to understand the application’s capabilities or a developer planning to extend the platform, this guide will provide all the necessary information.</p>

<h2 id="project-overview">Project Overview</h2>

<p>StructViz3D is built as a modern web application using React for the frontend and Three.js for 3D rendering. It supports multiple 3D file formats including STL and GLTF, making it versatile for different types of structural models.</p>

<p>Key features include:</p>
<ul>
  <li>Interactive 3D model visualization</li>
  <li>Support for STL and GLTF file formats</li>
  <li>Orthographic and perspective camera modes</li>
  <li>Advanced control options (rotation, pan, zoom)</li>
  <li>Customizable model appearance (colors, wireframe)</li>
  <li>Multiple grid systems for precise measurements</li>
  <li>Lighting controls for optimal model visualization</li>
  <li>Keyboard shortcuts for efficient workflow</li>
  <li>Fullscreen mode for detailed examination</li>
  <li>Responsive design for different screen sizes</li>
</ul>

<p>The application is designed with a focus on performance, usability, and extensibility, making it suitable for professional use in structural engineering and related fields.</p>

<h2 id="architecture">Architecture</h2>

<p>StructViz3D follows a component-based architecture using React. The application is structured around these main architectural elements:</p>

<ol>
  <li>
    <p><strong>Core Application Layer</strong>: Managed by the App component, handling the overall application state and user interface.</p>
  </li>
  <li>
    <p><strong>File Handling Layer</strong>: Responsible for uploading and processing 3D model files.</p>
  </li>
  <li>
    <p><strong>Rendering Engine</strong>: Based on Three.js, this layer handles all 3D rendering tasks including scene setup, camera management, and rendering loop.</p>
  </li>
  <li>
    <p><strong>Control System</strong>: A set of components that provide the user interface for interacting with the 3D model.</p>
  </li>
  <li>
    <p><strong>Utility Managers</strong>: Specialized manager classes for camera state, lighting, view presets, and other cross-cutting concerns.</p>
  </li>
</ol>

<p>This layered approach ensures separation of concerns, making the codebase more maintainable and extensible. Components communicate primarily through props and callbacks, with some specialized managers maintaining their own state for complex features.</p>

<h2 id="core-components">Core Components</h2>

<h3 id="app-component">App Component</h3>

<p>The App component serves as the entry point and main container for the StructViz3D application. It manages the high-level application state and orchestrates the interaction between various components.</p>

<p>Key responsibilities:</p>
<ul>
  <li>Managing application state (upload screen vs. viewer screen)</li>
  <li>Handling model URL and binary URL state</li>
  <li>Coordinating file uploads and model loading</li>
  <li>Providing the sample model functionality</li>
  <li>Managing the overall UI layout and transitions</li>
</ul>

<p>Implementation details:</p>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">App</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">modelUrl</span><span class="p">,</span> <span class="nx">setModelUrl</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">binUrl</span><span class="p">,</span> <span class="nx">setBinUrl</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span> <span class="nx">setIsLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">showUploadScreen</span><span class="p">,</span> <span class="nx">setShowUploadScreen</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    
    <span class="c1">// Handler for model loading</span>
    <span class="kd">const</span> <span class="nx">handleModelLoad</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">apiBaseUrl</span> <span class="o">=</span> <span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_APP_API_URL</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">modelUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">apiBaseUrl</span><span class="p">}${</span><span class="nx">data</span><span class="p">.</span><span class="nx">download_url</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">binUrl</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">bin_url</span> <span class="p">?</span> <span class="s2">`</span><span class="p">${</span><span class="nx">apiBaseUrl</span><span class="p">}${</span><span class="nx">data</span><span class="p">.</span><span class="nx">bin_url</span><span class="p">}</span><span class="s2">`</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nf">setModelUrl</span><span class="p">(</span><span class="nx">modelUrl</span><span class="p">);</span>
        <span class="nf">setBinUrl</span><span class="p">(</span><span class="nx">binUrl</span><span class="p">);</span>
        <span class="nf">setShowUploadScreen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="c1">// Other handlers and UI rendering...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The App component uses conditional rendering to switch between the upload screen and the viewer screen based on the application state. When a model is loaded, it transitions to the viewer screen and passes the model URL to the ModelViewer component.</p>

<h3 id="model-viewer">Model Viewer</h3>

<p>The ModelViewer component is the heart of the application, responsible for rendering and interacting with 3D models. It integrates with Three.js to create a fully functional 3D viewer with advanced capabilities.</p>

<p>Key responsibilities:</p>
<ul>
  <li>Setting up the Three.js scene, camera, and renderer</li>
  <li>Loading and displaying 3D models (STL and GLTF)</li>
  <li>Managing user interactions (orbit, pan, zoom)</li>
  <li>Handling camera modes and controls</li>
  <li>Implementing visual features (wireframe, grid, color)</li>
  <li>Coordinating with various control components</li>
</ul>

<p>The ModelViewer component is implemented as a functional component with hooks, managing a complex state and numerous side effects for 3D rendering and interaction.</p>

<h3 id="file-upload">File Upload</h3>

<p>The FileUpload component handles the uploading of 3D model files. While not fully shown in the provided code snippets, its role is to:</p>

<ul>
  <li>Provide a file selection interface</li>
  <li>Validate uploaded files</li>
  <li>Process and prepare files for viewing</li>
  <li>Pass the resulting model URL to the parent component</li>
</ul>

<h2 id="3d-rendering-engine">3D Rendering Engine</h2>

<h3 id="threejs-integration">Three.js Integration</h3>

<p>StructViz3D leverages Three.js, a powerful JavaScript 3D library, to handle all aspects of 3D rendering. The integration is primarily managed within the ModelViewer component.</p>

<p>Key aspects of Three.js integration:</p>
<ul>
  <li>Scene creation and management</li>
  <li>Camera setup (perspective and orthographic)</li>
  <li>WebGL renderer configuration</li>
  <li>Model loading and processing</li>
  <li>Lighting and shadow setup</li>
  <li>Control systems (OrbitControls)</li>
  <li>Animation loop management</li>
</ul>

<p>The application uses modern Three.js features, including:</p>
<ul>
  <li>SRGBColorSpace for correct color rendering</li>
  <li>PCFSoftShadowMap for realistic shadows</li>
  <li>ACESFilmicToneMapping for improved visual quality</li>
  <li>High-quality antialiasing for smooth edges</li>
</ul>

<h3 id="model-loading">Model Loading</h3>

<p>StructViz3D supports multiple 3D file formats through specialized loaders:</p>

<ol>
  <li><strong>STL Loader</strong>: For loading STL (STereoLithography) files commonly used in CAD and 3D printing.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">loadSTLModel</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">url</span><span class="p">,</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">onSuccess</span><span class="p">,</span> <span class="nx">onProgress</span><span class="p">,</span> <span class="nx">onError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">STLLoader</span><span class="p">();</span>
    <span class="nx">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="p">(</span><span class="nx">geometry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// Create material and mesh</span>
            <span class="kd">const</span> <span class="nx">material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">MeshStandardMaterial</span><span class="p">({</span>
                <span class="na">color</span><span class="p">:</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Color</span><span class="p">(</span><span class="nx">modelColor</span><span class="p">),</span>
                <span class="na">roughness</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                <span class="na">metalness</span><span class="p">:</span> <span class="mf">0.3</span>
            <span class="p">});</span>
            <span class="kd">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span><span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span><span class="p">);</span>
               
            <span class="c1">// Setup model in scene</span>
            <span class="nf">setupModel</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">scene</span><span class="p">);</span>
            <span class="nf">onSuccess</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">onProgress</span><span class="p">,</span>
        <span class="nx">onError</span>
    <span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">setupModel</span><span class="p">]);</span>
</code></pre></div>    </div>
  </li>
  <li><strong>GLTF Loader</strong>: For loading GLTF (GL Transmission Format) files, which are more complex models that can include materials, textures, and animations.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">loadGLTFModel</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">url</span><span class="p">,</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">onSuccess</span><span class="p">,</span> <span class="nx">onProgress</span><span class="p">,</span> <span class="nx">onError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GLTFLoader</span><span class="p">();</span>
    <span class="c1">// Set resource path for associated files</span>
    <span class="kd">const</span> <span class="nx">resourcePath</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">url</span><span class="p">.</span><span class="nf">lastIndexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">loader</span><span class="p">.</span><span class="nf">setResourcePath</span><span class="p">(</span><span class="nx">resourcePath</span><span class="p">);</span>
       
    <span class="nx">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="p">(</span><span class="nx">gltf</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">;</span>
            <span class="nf">setupModel</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">scene</span><span class="p">);</span>
               
            <span class="c1">// Apply materials and settings to all meshes</span>
            <span class="nx">model</span><span class="p">.</span><span class="nf">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Configure material properties</span>
                <span class="p">}</span>
            <span class="p">});</span>
               
            <span class="nf">onSuccess</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">onProgress</span><span class="p">,</span>
        <span class="nx">onError</span>
    <span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">setupModel</span><span class="p">]);</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>The loading process includes progress tracking and error handling to provide feedback to the user during the loading process.</p>

<h3 id="scene-management">Scene Management</h3>

<p>The scene management system in StructViz3D handles the organization and rendering of all 3D elements. It includes:</p>

<ol>
  <li><strong>Scene Setup</strong>: Creating and configuring the Three.js scene
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Scene</span><span class="p">();</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Color</span><span class="p">(</span><span class="nx">BG_COLOR</span><span class="p">);</span>
<span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">scene</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Model Positioning</strong>: Centering and scaling models appropriately
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">setupModel</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">model</span><span class="p">,</span> <span class="nx">scene</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>
       
    <span class="c1">// Create and add group</span>
    <span class="kd">const</span> <span class="nx">modelGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Group</span><span class="p">();</span>
    <span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">modelGroup</span><span class="p">);</span>
    <span class="nx">modelGroup</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
    <span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">modelGroup</span><span class="p">;</span>
       
    <span class="c1">// Center model</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Box3</span><span class="p">().</span><span class="nf">setFromObject</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">center</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getCenter</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
       
    <span class="c1">// Scale model</span>
    <span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getSize</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
    <span class="kd">const</span> <span class="nx">maxDim</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">maxDim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">DEFAULT_SCALE_FACTOR</span> <span class="o">/</span> <span class="nx">maxDim</span><span class="p">;</span>
        <span class="nx">modelGroup</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">scale</span><span class="p">);</span>
    <span class="p">}</span>
       
    <span class="k">return</span> <span class="p">{</span> <span class="nx">box</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">maxDim</span> <span class="p">};</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Helper Elements</strong>: Adding axes helpers for orientation
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">axesHelper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">AxesHelper</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">axesHelper</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">axesHelper</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Render Loop</strong>: Creating an efficient animation loop for continuous rendering
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">animate</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">animationFrameIdRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">animate</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">update</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Resource Management</strong>: Properly cleaning up resources when components unmount or models change
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cleanupResources</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Dispose of geometries, materials, textures</span>
    <span class="c1">// Clean up scene elements</span>
    <span class="c1">// Cancel animations</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>This comprehensive scene management ensures optimal performance and visual quality throughout the application lifecycle.</p>

<h2 id="camera-system">Camera System</h2>

<h3 id="camera-modes">Camera Modes</h3>

<p>StructViz3D provides two different camera modes to accommodate different visualization needs:</p>

<ol>
  <li><strong>Perspective Camera</strong>: The default mode, providing a natural perspective view similar to human vision. Objects appear smaller as they get further away.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">perspCamera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">PerspectiveCamera</span><span class="p">(</span>
    <span class="mi">75</span><span class="p">,</span>
    <span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">,</span>
    <span class="mf">0.1</span><span class="p">,</span>
    <span class="mi">1000</span>
<span class="p">);</span>
<span class="nx">perspCamera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Orthographic Camera</strong>: An alternative mode that removes perspective distortion, making it easier to compare sizes and dimensions. This mode is particularly useful for technical and engineering visualizations.
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">frustumSize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">OrthographicCamera</span><span class="p">(</span>
    <span class="nx">frustumSize</span> <span class="o">*</span> <span class="nx">aspect</span> <span class="o">/</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
    <span class="nx">frustumSize</span> <span class="o">*</span> <span class="nx">aspect</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">frustumSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">frustumSize</span> <span class="o">/</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
    <span class="mf">0.1</span><span class="p">,</span>
    <span class="mi">1000</span>
<span class="p">);</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Users can toggle between these camera modes using the camera controls in the UI. The system preserves position and orientation when switching between modes for a seamless experience.</p>

<h3 id="camera-controls">Camera Controls</h3>

<p>The camera control system is built on Three.js OrbitControls, providing intuitive interaction with the 3D scene:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">controls</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OrbitControls</span><span class="p">(</span><span class="nx">perspCamera</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">);</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">enableDamping</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">dampingFactor</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">enableZoom</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">enablePan</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">panSpeed</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">zoomSpeed</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">rotateSpeed</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">mouseButtons</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">LEFT</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">ROTATE</span><span class="p">,</span>
    <span class="na">MIDDLE</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">DOLLY</span><span class="p">,</span>
    <span class="na">RIGHT</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">PAN</span>
<span class="p">};</span>
</code></pre></div></div>

<p>These controls allow users to:</p>
<ul>
  <li><strong>Rotate</strong> the camera around the model (default left mouse button)</li>
  <li><strong>Pan</strong> the view (right mouse button or drag mode)</li>
  <li><strong>Zoom</strong> in and out (mouse wheel or dedicated controls)</li>
</ul>

<p>The controls are configured with carefully tuned parameters for smooth and intuitive interaction.</p>

<h3 id="camera-state-management">Camera State Management</h3>

<p>The application includes a sophisticated camera state management system through the <code class="language-plaintext highlighter-rouge">cameraStateManager</code> utility. This manager:</p>

<ul>
  <li>Maintains synchronization between perspective and orthographic cameras</li>
  <li>Preserves camera positions and orientations when switching modes</li>
  <li>Handles camera reset and view presets</li>
  <li>Adjusts camera parameters based on model size</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cameraStateManager</span><span class="p">.</span><span class="nf">initialize</span><span class="p">(</span>
    <span class="nx">perspectiveCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span>
    <span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span>
    <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span>
    <span class="nf">getModelSize</span><span class="p">()</span>
<span class="p">);</span>
</code></pre></div></div>

<p>The camera state manager ensures a consistent and intuitive camera experience throughout different interaction modes and view changes.</p>

<h2 id="visualization-features">Visualization Features</h2>

<h3 id="wireframe-mode">Wireframe Mode</h3>

<p>Wireframe mode renders the model as a mesh of lines, making it easier to see the underlying structure and geometry:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">toggleWireframe</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">newWireframeState</span> <span class="o">=</span> <span class="o">!</span><span class="nx">isWireframe</span><span class="p">;</span>
    <span class="nf">setIsWireframe</span><span class="p">(</span><span class="nx">newWireframeState</span><span class="p">);</span>
    
    <span class="k">if </span><span class="p">(</span><span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">material</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="nx">material</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">newWireframeState</span><span class="p">;</span>
                        <span class="k">if </span><span class="p">(</span><span class="nx">newWireframeState</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                            <span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinecap</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                            <span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinejoin</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">newWireframeState</span><span class="p">;</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">newWireframeState</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinecap</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                        <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinejoin</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">isWireframe</span><span class="p">]);</span>
</code></pre></div></div>

<p>The wireframe mode can be toggled on and off, and includes styling options like line width and caps for improved visibility.</p>

<h3 id="enhanced-wireframe">Enhanced Wireframe</h3>

<p>In addition to the standard wireframe mode, StructViz3D includes an enhanced wireframe mode through the <code class="language-plaintext highlighter-rouge">EnhancedWireframeMode</code> utility. This provides a more sophisticated wireframe visualization, potentially with features like:</p>

<ul>
  <li>Better line visibility</li>
  <li>Silhouette edge highlighting</li>
  <li>“Pencil sketch” rendering style</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">EnhancedWireframeMode</span><span class="p">.</span><span class="nf">applyPencilView</span><span class="p">(</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></div></div>

<p>This advanced wireframe rendering is particularly useful for architectural and design presentations where aesthetic quality is important.</p>

<h3 id="color-management">Color Management</h3>

<p>StructViz3D includes a color management system that allows users to customize the model’s appearance:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">updateModelColor</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">color</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Update the state</span>
    <span class="nf">setModelColor</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
    
    <span class="c1">// Use the utility function to update the model material</span>
    <span class="nx">ViewerControlsUtils</span><span class="p">.</span><span class="nf">updateModelColor</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">modelRef</span><span class="p">);</span>
    
    <span class="c1">// Re-apply wireframe if it's enabled</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">isWireframe</span> <span class="o">&amp;&amp;</span> <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">material</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="nx">material</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">isWireframe</span><span class="p">]);</span>
</code></pre></div></div>

<p>The color management system works with both solid and wireframe rendering modes, preserving other material properties like roughness and metalness.</p>

<h3 id="grid-systems">Grid Systems</h3>

<p>To aid in spatial understanding and measurement, StructViz3D provides three different grid systems that can be toggled independently:</p>

<ol>
  <li><strong>XZ Grid</strong>: The horizontal ground plane grid (default)</li>
  <li><strong>XY Grid</strong>: Vertical grid along the Y-axis</li>
  <li><strong>YZ Grid</strong>: Vertical grid along the Z-axis</li>
</ol>

<p>Each grid can be independently toggled and customized:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">toggleXZGrid</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">setShowXZGrid</span><span class="p">(</span><span class="nx">prev</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">prev</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>

<span class="kd">const</span> <span class="nx">toggleXYGrid</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">setShowXYGrid</span><span class="p">(</span><span class="nx">prev</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">prev</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>

<span class="kd">const</span> <span class="nx">toggleYZGrid</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">setShowYZGrid</span><span class="p">(</span><span class="nx">prev</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">prev</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<p>Grid customization options include:</p>
<ul>
  <li>Grid color</li>
  <li>Number of divisions</li>
  <li>Grid size</li>
</ul>

<p>The grid systems help users understand the scale and orientation of the model, as well as provide reference points for measurements.</p>

<h2 id="lighting-system">Lighting System</h2>

<h3 id="default-lighting-setup">Default Lighting Setup</h3>

<p>StructViz3D implements a sophisticated lighting system to enhance model visibility and detail. The lighting setup is managed through the <code class="language-plaintext highlighter-rouge">lightingManager</code> utility:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">setupLighting</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">scene</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">lightingManager</span><span class="p">.</span><span class="nf">setupLighting</span><span class="p">(</span><span class="nx">scene</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<p>The default lighting setup likely includes:</p>
<ul>
  <li>Ambient light for overall illumination</li>
  <li>Directional lights for shadows and highlights</li>
  <li>Hemisphere light for natural environment lighting</li>
  <li>Point or spot lights for specific highlighting</li>
</ul>

<p>This comprehensive lighting system ensures models are well-lit from all angles while maintaining realistic shadows and highlights.</p>

<h3 id="lighting-controls">Lighting Controls</h3>

<p>The application includes lighting controls through the <code class="language-plaintext highlighter-rouge">LightingControls</code> component:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">LightingControls</span> <span class="na">scene</span><span class="p">=</span><span class="si">{</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span> <span class="p">/&gt;</span>
</code></pre></div></div>

<p>These controls allow users to customize the lighting setup, potentially including:</p>
<ul>
  <li>Light intensity adjustment</li>
  <li>Light color customization</li>
  <li>Light position control</li>
  <li>Shadow quality settings</li>
  <li>Environment lighting options</li>
</ul>

<p>The lighting controls help users achieve the optimal visualization for their specific model and purpose, whether technical analysis or presentation.</p>

<h2 id="user-interface">User Interface</h2>

<h3 id="viewer-controls">Viewer Controls</h3>

<p>The main viewer controls are implemented through the <code class="language-plaintext highlighter-rouge">ViewerControls</code> component, which provides a central hub for all interaction controls:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">ViewerControls</span>
    <span class="na">isFullscreen</span><span class="p">=</span><span class="si">{</span><span class="nx">isFullscreen</span><span class="si">}</span>
    <span class="na">toggleFullscreen</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleFullscreen</span><span class="si">}</span>
    <span class="na">visible</span><span class="p">=</span><span class="si">{</span><span class="nx">controlsVisible</span><span class="si">}</span>
    <span class="na">locked</span><span class="p">=</span><span class="si">{</span><span class="nx">controlsLocked</span><span class="si">}</span>
    <span class="na">onToggleLock</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleControlsLock</span><span class="si">}</span>
    <span class="na">onToggleShortcuts</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleShortcuts</span><span class="si">}</span>
    <span class="na">onZoomIn</span><span class="p">=</span><span class="si">{</span><span class="nx">handleZoomIn</span><span class="si">}</span>
    <span class="na">onZoomOut</span><span class="p">=</span><span class="si">{</span><span class="nx">handleZoomOut</span><span class="si">}</span>
    <span class="na">dragModeEnabled</span><span class="p">=</span><span class="si">{</span><span class="nx">dragModeEnabled</span><span class="si">}</span>
    <span class="na">toggleDragMode</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleDragMode</span><span class="si">}</span>
<span class="p">&gt;</span>
    <span class="si">{</span><span class="cm">/* Child control components */</span><span class="si">}</span>
<span class="p">&lt;/</span><span class="nc">ViewerControls</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>This component serves as a container for various specialized control panels, manages the visibility and positioning of controls, and handles core viewer functionality like fullscreen toggling and zoom controls.</p>

<h3 id="control-panel">Control Panel</h3>

<p>The control panel is a collection of specialized control components, each focused on a specific aspect of the visualization:</p>

<ol>
  <li><strong>ColorSelector</strong>: For changing the model color
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">ColorSelector</span>
    <span class="na">currentColor</span><span class="p">=</span><span class="si">{</span><span class="nx">modelColor</span><span class="si">}</span>
    <span class="na">onColorChange</span><span class="p">=</span><span class="si">{</span><span class="nx">updateModelColor</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li><strong>CameraControls</strong>: For switching between perspective and orthographic cameras
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">CameraControls</span>
    <span class="na">isOrthographic</span><span class="p">=</span><span class="si">{</span><span class="nx">isOrthographic</span><span class="si">}</span>
    <span class="na">toggleCameraMode</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleCameraMode</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li><strong>ViewControls</strong>: For preset views and camera positioning
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">ViewControls</span>
    <span class="na">cameraManager</span><span class="p">=</span><span class="si">{</span><span class="nx">cameraStateManager</span><span class="si">}</span>
    <span class="na">currentCamera</span><span class="p">=</span><span class="si">{</span><span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">controls</span><span class="p">=</span><span class="si">{</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">modelRef</span><span class="p">=</span><span class="si">{</span><span class="nx">modelRef</span><span class="si">}</span>
    <span class="na">isOrthographic</span><span class="p">=</span><span class="si">{</span><span class="nx">isOrthographic</span><span class="si">}</span>
    <span class="na">setAnimating</span><span class="p">=</span><span class="si">{</span><span class="nx">setAnimating</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li><strong>GridControls</strong>: For customizing the reference grids
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">GridControls</span>
    <span class="na">scene</span><span class="p">=</span><span class="si">{</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">showXZGrid</span><span class="p">=</span><span class="si">{</span><span class="nx">showXZGrid</span><span class="si">}</span>
    <span class="na">showXYGrid</span><span class="p">=</span><span class="si">{</span><span class="nx">showXYGrid</span><span class="si">}</span>
    <span class="na">showYZGrid</span><span class="p">=</span><span class="si">{</span><span class="nx">showYZGrid</span><span class="si">}</span>
    <span class="na">gridDivisions</span><span class="p">=</span><span class="si">{</span><span class="nx">gridDivisions</span><span class="si">}</span>
    <span class="na">xzGridColor</span><span class="p">=</span><span class="si">{</span><span class="nx">xzGridColor</span><span class="si">}</span>
    <span class="na">xyGridColor</span><span class="p">=</span><span class="si">{</span><span class="nx">xyGridColor</span><span class="si">}</span>
    <span class="na">yzGridColor</span><span class="p">=</span><span class="si">{</span><span class="nx">yzGridColor</span><span class="si">}</span>
    <span class="na">onToggleXZGrid</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleXZGrid</span><span class="si">}</span>
    <span class="na">onToggleXYGrid</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleXYGrid</span><span class="si">}</span>
    <span class="na">onToggleYZGrid</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleYZGrid</span><span class="si">}</span>
    <span class="na">onGridDivisionsChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleGridDivisionsChange</span><span class="si">}</span>
    <span class="na">onXZGridColorChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleXZGridColorChange</span><span class="si">}</span>
    <span class="na">onXYGridColorChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleXYGridColorChange</span><span class="si">}</span>
    <span class="na">onYZGridColorChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleYZGridColorChange</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li><strong>OrientationControls</strong>: For model orientation
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">OrientationControls</span>
    <span class="na">modelGroup</span><span class="p">=</span><span class="si">{</span><span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">resetOrientation</span><span class="p">=</span><span class="si">{</span><span class="nx">resetModelOrientation</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li><strong>WireframeControls</strong>: For wireframe visualization options
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">WireframeControls</span>
    <span class="na">modelRef</span><span class="p">=</span><span class="si">{</span><span class="nx">modelRef</span><span class="si">}</span>
    <span class="na">isWireframe</span><span class="p">=</span><span class="si">{</span><span class="nx">isWireframe</span><span class="si">}</span>
    <span class="na">toggleWireframe</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleWireframe</span><span class="si">}</span>
    <span class="na">scene</span><span class="p">=</span><span class="si">{</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">renderer</span><span class="p">=</span><span class="si">{</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">currentCamera</span><span class="p">=</span><span class="si">{</span><span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Each control panel is focused on a specific aspect of the visualization, providing an intuitive and organized interface for adjusting various settings.</p>

<h3 id="keyboard-shortcuts">Keyboard Shortcuts</h3>

<p>StructViz3D includes keyboard shortcuts for efficient workflow through the <code class="language-plaintext highlighter-rouge">KeyboardShortcuts</code> component:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">KeyboardShortcuts</span>
    <span class="na">isVisible</span><span class="p">=</span><span class="si">{</span><span class="nx">shortcutsVisible</span><span class="si">}</span>
    <span class="na">onClose</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setShortcutsVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div></div>

<p>This component likely provides both a visual reference for available keyboard shortcuts and the implementation of those shortcuts. Common shortcuts might include:</p>
<ul>
  <li>View orientation presets (top, front, side)</li>
  <li>Toggle wireframe mode</li>
  <li>Toggle grid visibility</li>
  <li>Reset view</li>
  <li>Zoom to fit</li>
  <li>Toggle fullscreen</li>
</ul>

<p>The keyboard shortcuts allow power users to navigate and adjust the visualization quickly without relying on mouse interactions with the UI.</p>

<h2 id="interaction-modes">Interaction Modes</h2>

<h3 id="rotation-mode">Rotation Mode</h3>

<p>The default interaction mode allows users to rotate the camera around the model:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">controls</span><span class="p">.</span><span class="nx">mouseButtons</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">LEFT</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">ROTATE</span><span class="p">,</span>
    <span class="na">MIDDLE</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">DOLLY</span><span class="p">,</span>
    <span class="na">RIGHT</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">PAN</span>
<span class="p">};</span>
</code></pre></div></div>

<p>In this mode, the left mouse button rotates the camera around the focal point, providing an intuitive way to examine the model from different angles.</p>

<h3 id="drag-mode">Drag Mode</h3>

<p>An alternative interaction mode changes the left mouse button behavior to panning instead of rotation:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">toggleDragMode</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">newDragMode</span> <span class="o">=</span> <span class="o">!</span><span class="nx">dragModeEnabled</span><span class="p">;</span>
    <span class="nf">setDragModeEnabled</span><span class="p">(</span><span class="nx">newDragMode</span><span class="p">);</span>
    
    <span class="k">if </span><span class="p">(</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">newDragMode</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Switch to drag/pan mode</span>
            <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">LEFT</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">PAN</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Switch back to rotation mode</span>
            <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">LEFT</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">ROTATE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">dragModeEnabled</span><span class="p">]);</span>
</code></pre></div></div>

<p>This mode is particularly useful when precise positioning of the model in the view is required.</p>

<h3 id="zoom-functionality">Zoom Functionality</h3>

<p>StructViz3D implements an advanced zoom system that can target specific parts of the model:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">handleZoom</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
    
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">container</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    
    <span class="c1">// Get mouse position in normalized device coordinates</span>
    <span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nf">getBoundingClientRect</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">((</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">/</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">/</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    
    <span class="c1">// Create raycaster and find intersection point with model</span>
    <span class="kd">const</span> <span class="nx">raycaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Raycaster</span><span class="p">();</span>
    <span class="nx">raycaster</span><span class="p">.</span><span class="nf">setFromCamera</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector2</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">),</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
    
    <span class="c1">// Check for intersections with model</span>
    <span class="kd">const</span> <span class="nx">intersects</span> <span class="o">=</span> <span class="nx">raycaster</span><span class="p">.</span><span class="nf">intersectObject</span><span class="p">(</span><span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    
    <span class="k">if </span><span class="p">(</span><span class="nx">intersects</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Get zoom delta and direction</span>
        <span class="kd">const</span> <span class="nx">zoomDelta</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">deltaY</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">;</span>  <span class="c1">// Adjust sensitivity here</span>
        
        <span class="c1">// Calculate target position (the intersection point)</span>
        <span class="kd">const</span> <span class="nx">targetPos</span> <span class="o">=</span> <span class="nx">intersects</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">point</span><span class="p">;</span>
        
        <span class="c1">// Move camera along the direction toward/away from the intersection point</span>
        <span class="kd">const</span> <span class="nx">cameraPos</span> <span class="o">=</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">direction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">().</span><span class="nf">subVectors</span><span class="p">(</span><span class="nx">targetPos</span><span class="p">,</span> <span class="nx">cameraPos</span><span class="p">).</span><span class="nf">normalize</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">distance</span> <span class="o">=</span> <span class="nx">direction</span><span class="p">.</span><span class="nf">multiplyScalar</span><span class="p">(</span><span class="nx">zoomDelta</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span>
        
        <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">distance</span><span class="p">);</span>
        <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">update</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Fallback to default OrbitControls zoom</span>
        <span class="kd">const</span> <span class="nx">zoomDelta</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">deltaY</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">;</span>
        <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">zoom</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">pow</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="nx">zoomDelta</span><span class="p">));</span>
        <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">update</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">container</span><span class="p">]);</span>
</code></pre></div></div>

<p>This zoom functionality tries to zoom toward the point under the mouse cursor when possible, providing a more intuitive zoom experience. If no model point is found, it falls back to standard zoom behavior.</p>

<p>Additional zoom controls are provided through dedicated buttons:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">handleZoomIn</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ViewerControlsUtils</span><span class="p">.</span><span class="nf">handleZoomIn</span><span class="p">(</span>
        <span class="nx">isOrthographic</span><span class="p">,</span>
        <span class="nx">orthographicCameraRef</span><span class="p">,</span>
        <span class="nx">currentCameraRef</span><span class="p">,</span>
        <span class="nx">controlsRef</span>
    <span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">isOrthographic</span><span class="p">]);</span>

<span class="kd">const</span> <span class="nx">handleZoomOut</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ViewerControlsUtils</span><span class="p">.</span><span class="nf">handleZoomOut</span><span class="p">(</span>
        <span class="nx">isOrthographic</span><span class="p">,</span>
        <span class="nx">orthographicCameraRef</span><span class="p">,</span>
        <span class="nx">currentCameraRef</span><span class="p">,</span>
        <span class="nx">controlsRef</span>
    <span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">isOrthographic</span><span class="p">]);</span>
</code></pre></div></div>

<p>These functions handle zoom differently based on the current camera mode (perspective or orthographic).</p>

<h2 id="model-orientation">Model Orientation</h2>

<h3 id="initial-orientation">Initial Orientation</h3>

<p>When a model is first loaded, StructViz3D automatically sets an optimal initial view:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">setOptimalInitialView</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">model</span> <span class="o">||</span> <span class="o">!</span><span class="nx">cameraRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="nx">initialPositionSet</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">const</span> <span class="nx">success</span> <span class="o">=</span> <span class="nx">viewManager</span><span class="p">.</span><span class="nf">setOptimalInitialView</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">cameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">setInitialPositionSet</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">initialPositionSet</span><span class="p">]);</span>
</code></pre></div></div>

<p>This function uses the <code class="language-plaintext highlighter-rouge">viewManager</code> utility to analyze the model and determine the best initial camera position and orientation. The view is optimized to show the model clearly and completely within the viewport.</p>

<h3 id="orientation-controls">Orientation Controls</h3>

<p>The application includes dedicated orientation controls through the <code class="language-plaintext highlighter-rouge">OrientationControls</code> component:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">OrientationControls</span>
    <span class="na">modelGroup</span><span class="p">=</span><span class="si">{</span><span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span><span class="si">}</span>
    <span class="na">resetOrientation</span><span class="p">=</span><span class="si">{</span><span class="nx">resetModelOrientation</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div></div>

<p>These controls allow users to:</p>
<ul>
  <li>Reset the model to its original orientation</li>
  <li>Rotate the model to standard views (top, front, side, etc.)</li>
  <li>Fine-tune the model orientation</li>
</ul>

<p>The reset functionality is implemented as:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">resetModelOrientation</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Reset the rotation</span>
        <span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        
        <span class="c1">// After resetting orientation, we may want to update the controls target</span>
        <span class="c1">// to ensure the camera is still focused correctly</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">update</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<p>This reset function ensures the model returns to its original orientation while maintaining the camera’s focus on the model.</p>

<h2 id="resource-management">Resource Management</h2>

<h3 id="loading-optimization">Loading Optimization</h3>

<p>StructViz3D implements several optimizations for model loading:</p>

<ol>
  <li><strong>Progress Tracking</strong>: Providing feedback during the loading process
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">total</span> <span class="p">?</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">progress</span><span class="p">.</span><span class="nf">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">% loaded`</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Error Handling</strong>: Graceful error handling for failed loads
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error loading model:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="nf">setError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to load the model. Please try again.</span><span class="dl">'</span><span class="p">);</span>
    <span class="nf">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Resource Path Management</strong>: Setting the correct path for associated resources
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">resourcePath</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">url</span><span class="p">.</span><span class="nf">lastIndexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">loader</span><span class="p">.</span><span class="nf">setResourcePath</span><span class="p">(</span><span class="nx">resourcePath</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>These optimizations ensure efficient and reliable model loading, even for complex models or slower network connections.</p>

<h2 id="resource-management-1">Resource Management</h2>

<h3 id="loading-optimization-1">Loading Optimization</h3>

<p>StructViz3D implements several strategies to optimize the loading of 3D models, ensuring smooth user experience even with complex structural models:</p>

<h4 id="1-progressive-loading">1. Progressive Loading</h4>

<p>The application utilizes a progressive loading approach, providing visual feedback during the loading process:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Progress tracking during model loading</span>
<span class="nx">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span>
    <span class="nx">url</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">geometry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Success callback</span>
        <span class="c1">// Model creation and setup happens here</span>
    <span class="p">},</span>
    <span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Progress callback</span>
        <span class="kd">const</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">total</span> <span class="p">?</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">progress</span><span class="p">.</span><span class="nf">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">% loaded`</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Error callback</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error loading model:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">setError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to load the model. Please try again.</span><span class="dl">'</span><span class="p">);</span>
        <span class="nf">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p>This implementation provides real-time progress updates during model loading, allowing users to understand the loading status of large models.</p>

<h4 id="2-asynchronous-loading">2. Asynchronous Loading</h4>

<p>All model loading operations are performed asynchronously to prevent blocking the main UI thread:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Asynchronous model loading pattern</span>
<span class="kd">const</span> <span class="nx">loadSTLModel</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">url</span><span class="p">,</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">onSuccess</span><span class="p">,</span> <span class="nx">onProgress</span><span class="p">,</span> <span class="nx">onError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">STLLoader</span><span class="p">();</span>
    <span class="nx">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="p">(</span><span class="nx">geometry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// Process geometry and create mesh</span>
            <span class="nf">onSuccess</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">onProgress</span><span class="p">,</span>
        <span class="nx">onError</span>
    <span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">setupModel</span><span class="p">,</span> <span class="nx">modelColor</span><span class="p">,</span> <span class="nx">isWireframe</span><span class="p">]);</span>
</code></pre></div></div>

<p>This pattern ensures the application remains responsive during loading operations, particularly important for large models that might take longer to process.</p>

<h4 id="3-resource-path-management">3. Resource Path Management</h4>

<p>For GLTF models that may reference external resources, the application intelligently sets resource paths:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Set resource path for associated files</span>
<span class="kd">const</span> <span class="nx">resourcePath</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">url</span><span class="p">.</span><span class="nf">lastIndexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">loader</span><span class="p">.</span><span class="nf">setResourcePath</span><span class="p">(</span><span class="nx">resourcePath</span><span class="p">);</span>
</code></pre></div></div>

<p>This ensures that textures, materials, and other dependencies are properly resolved relative to the model file location.</p>

<h4 id="4-loading-states">4. Loading States</h4>

<p>The UI provides clear visual indicators of loading states:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nx">loading</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">loading-overlay</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">spinner</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Loading</span> <span class="nx">model</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="p">)}</span>
</code></pre></div></div>

<p>This feedback mechanism helps users understand when the system is processing data, improving the perceived performance and user experience.</p>

<h3 id="memory-management">Memory Management</h3>

<p>Effective memory management is crucial for a 3D visualization tool, especially when dealing with complex structural models. StructViz3D implements several techniques to optimize memory usage:</p>

<h4 id="1-resource-disposal">1. Resource Disposal</h4>

<p>The application properly disposes of Three.js resources when they’re no longer needed:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Clean up resources</span>
<span class="kd">const</span> <span class="nx">cleanupResources</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Dispose of the model</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">geometry</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nf">dispose</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">if </span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">material</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="k">if </span><span class="p">(</span><span class="nx">material</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="nx">material</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nf">dispose</span><span class="p">();</span>
                        <span class="nx">material</span><span class="p">.</span><span class="nf">dispose</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nf">dispose</span><span class="p">();</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nf">dispose</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="c1">// Additional cleanup operations...</span>
<span class="p">});</span>
</code></pre></div></div>

<p>This systematic disposal of geometries, materials, and textures prevents memory leaks that could otherwise accumulate and degrade performance.</p>

<h4 id="2-reference-management">2. Reference Management</h4>

<p>The application carefully manages object references using React’s useRef hook:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Refs for Three.js objects</span>
<span class="kd">const</span> <span class="nx">sceneRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">modelRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">rendererRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">lightsRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">([]);</span>
<span class="kd">const</span> <span class="nx">controlsRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cameraRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="c1">// Additional refs...</span>
</code></pre></div></div>

<p>This approach ensures that Three.js objects aren’t unnecessarily recreated during React’s rendering cycles, minimizing both memory usage and GC pressure.</p>

<h4 id="3-model-optimization">3. Model Optimization</h4>

<p>When loading models, StructViz3D applies optimization techniques to balance visual quality and memory usage:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Model setup with optimization</span>
<span class="kd">const</span> <span class="nx">setupModel</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">model</span><span class="p">,</span> <span class="nx">scene</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>

    <span class="c1">// Create and add group</span>
    <span class="kd">const</span> <span class="nx">modelGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Group</span><span class="p">();</span>
    <span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">modelGroup</span><span class="p">);</span>
    <span class="nx">modelGroup</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
    <span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">modelGroup</span><span class="p">;</span>

    <span class="c1">// Center model</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Box3</span><span class="p">().</span><span class="nf">setFromObject</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">center</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getCenter</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>

    <span class="c1">// Scale model appropriately</span>
    <span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getSize</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
    <span class="kd">const</span> <span class="nx">maxDim</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">maxDim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">DEFAULT_SCALE_FACTOR</span> <span class="o">/</span> <span class="nx">maxDim</span><span class="p">;</span>
        <span class="nx">modelGroup</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">scale</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span> <span class="nx">box</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">maxDim</span> <span class="p">};</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<p>This optimization ensures models are properly scaled and centered, improving rendering efficiency and memory usage for various model sizes.</p>

<h4 id="4-cancellation-of-animations">4. Cancellation of Animations</h4>

<p>The application properly cancels animation frames when components unmount or when switching between models:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Cancel animations</span>
<span class="k">if </span><span class="p">(</span><span class="nx">animationFrameIdRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">cancelAnimationFrame</span><span class="p">(</span><span class="nx">animationFrameIdRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if </span><span class="p">(</span><span class="nx">animationRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">cancelAnimationFrame</span><span class="p">(</span><span class="nx">animationRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This prevents unnecessary rendering operations and helps maintain optimal performance.</p>

<h4 id="5-context-loss-handling">5. Context Loss Handling</h4>

<p>The WebGL context is properly handled during cleanup:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Dispose of renderer</span>
<span class="k">if </span><span class="p">(</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">dispose</span><span class="p">();</span>
    <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">forceContextLoss</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This forceful context loss ensures proper GPU resource cleanup, preventing resource leaks in the graphics system.</p>

<h2 id="performance-optimization">Performance Optimization</h2>

<h3 id="render-loop">Render Loop</h3>

<p>The render loop is a critical component for a 3D visualization tool, directly impacting performance and responsiveness. StructViz3D implements an optimized render loop with several performance-enhancing techniques:</p>

<h4 id="1-efficient-animation-loop">1. Efficient Animation Loop</h4>

<p>The main render loop uses requestAnimationFrame for optimal performance and battery efficiency:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">animate</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">animationFrameIdRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="nx">animate</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">update</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This implementation ensures rendering is synced with the browser’s refresh rate and paused when the tab is inactive, optimizing resource usage.</p>

<h4 id="2-conditional-rendering">2. Conditional Rendering</h4>

<p>Render operations are guarded by existence checks to prevent errors and unnecessary operations:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="p">(</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This pattern prevents render attempts when resources aren’t available, enhancing application stability.</p>

<h4 id="3-optimized-controls-update">3. Optimized Controls Update</h4>

<p>Control updates are conditionally performed only when the controls exist:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="p">(</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">update</span><span class="p">();</span>
</code></pre></div></div>

<p>This prevents unnecessary function calls and potential errors when controls haven’t been initialized yet.</p>

<h4 id="4-renderer-configuration">4. Renderer Configuration</h4>

<p>The WebGL renderer is configured for optimal performance:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">WebGLRenderer</span><span class="p">({</span>
    <span class="na">antialias</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">alpha</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">preserveDrawingBuffer</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">);</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nf">setPixelRatio</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">);</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">outputColorSpace</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SRGBColorSpace</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">shadowMap</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">shadowMap</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PCFSoftShadowMap</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">toneMapping</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ACESFilmicToneMapping</span><span class="p">;</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">toneMappingExposure</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">;</span>
</code></pre></div></div>

<p>This configuration balances visual quality and performance, with options like antialias for smooth edges and PCFSoftShadowMap for better shadow quality at a reasonable performance cost.</p>

<h4 id="5-camera-damping">5. Camera Damping</h4>

<p>The OrbitControls are configured with damping for smoother camera movement:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">controls</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OrbitControls</span><span class="p">(</span><span class="nx">perspCamera</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">);</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">enableDamping</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">dampingFactor</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="c1">// Additional control settings...</span>
</code></pre></div></div>

<p>This creates a more natural, inertia-based camera movement that improves user experience while requiring continual updates in the render loop.</p>

<h3 id="geometry-management">Geometry Management</h3>

<p>Efficient geometry management is essential for maintaining high performance with complex 3D models. StructViz3D implements several strategies for optimal geometry handling:</p>

<h4 id="1-model-scaling-and-centering">1. Model Scaling and Centering</h4>

<p>Models are automatically scaled and centered for optimal viewing:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Center model</span>
<span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Box3</span><span class="p">().</span><span class="nf">setFromObject</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">center</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getCenter</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>

<span class="c1">// Scale model</span>
<span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getSize</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
<span class="kd">const</span> <span class="nx">maxDim</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
<span class="k">if </span><span class="p">(</span><span class="nx">maxDim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">DEFAULT_SCALE_FACTOR</span> <span class="o">/</span> <span class="nx">maxDim</span><span class="p">;</span>
    <span class="nx">modelGroup</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">scale</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This ensures that models of varying sizes are displayed appropriately within the viewport, improving user experience and rendering efficiency.</p>

<h4 id="2-material-optimization">2. Material Optimization</h4>

<p>Materials are applied efficiently with optimized properties:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create material with optimized properties</span>
<span class="kd">const</span> <span class="nx">material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">MeshStandardMaterial</span><span class="p">({</span>
    <span class="na">color</span><span class="p">:</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Color</span><span class="p">(</span><span class="nx">modelColor</span><span class="p">),</span>
    <span class="na">roughness</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
    <span class="na">metalness</span><span class="p">:</span> <span class="mf">0.3</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Using MeshStandardMaterial with carefully selected roughness and metalness values provides a good balance between visual quality and performance.</p>

<h4 id="3-hierarchy-management">3. Hierarchy Management</h4>

<p>Models are organized within a group structure for efficient transformations:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create and add group</span>
<span class="kd">const</span> <span class="nx">modelGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Group</span><span class="p">();</span>
<span class="nx">scene</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">modelGroup</span><span class="p">);</span>
<span class="nx">modelGroup</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<span class="nx">modelGroupRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">modelGroup</span><span class="p">;</span>
</code></pre></div></div>

<p>This hierarchical approach allows for efficient application of transformations (like scaling and rotation) to the entire model at once.</p>

<h4 id="4-bounding-box-calculations">4. Bounding Box Calculations</h4>

<p>Bounding boxes are used for various optimizations:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Box3</span><span class="p">().</span><span class="nf">setFromObject</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nf">getSize</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nc">Vector3</span><span class="p">());</span>
<span class="kd">const</span> <span class="nx">maxDim</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
</code></pre></div></div>

<p>This information is used for scaling, centering, and determining optimal camera positions, improving rendering efficiency and user experience.</p>

<h4 id="5-wireframe-optimization">5. Wireframe Optimization</h4>

<p>Wireframe mode is implemented with optimization considerations:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">toggleWireframe</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">newWireframeState</span> <span class="o">=</span> <span class="o">!</span><span class="nx">isWireframe</span><span class="p">;</span>
    <span class="nf">setIsWireframe</span><span class="p">(</span><span class="nx">newWireframeState</span><span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">material</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="nx">material</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">newWireframeState</span><span class="p">;</span>
                        <span class="k">if </span><span class="p">(</span><span class="nx">newWireframeState</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                            <span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinecap</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                            <span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinejoin</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">newWireframeState</span><span class="p">;</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">newWireframeState</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinecap</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                        <span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">wireframeLinejoin</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">round</span><span class="dl">'</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">isWireframe</span><span class="p">]);</span>
</code></pre></div></div>

<p>Rather than creating new geometries for wireframe display, the application toggles the wireframe property on existing materials, which is more efficient for memory usage and performance.</p>

<h2 id="responsive-design">Responsive Design</h2>

<p>StructViz3D is built with responsiveness in mind, ensuring a consistent experience across different devices and screen sizes:</p>

<h3 id="1-responsive-container">1. Responsive Container</h3>

<p>The application adapts to container dimensions, making it suitable for various layout contexts:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">handleResize</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">container</span> <span class="o">||</span> <span class="o">!</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">width</span> <span class="o">/</span> <span class="nx">height</span><span class="p">;</span>

    <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">setSize</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>

    <span class="c1">// Update perspective camera</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">perspectiveCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">perspectiveCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">aspect</span> <span class="o">=</span> <span class="nx">aspect</span><span class="p">;</span>
        <span class="nx">perspectiveCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">updateProjectionMatrix</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Update orthographic camera</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">frustumSize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">frustumSize</span> <span class="o">*</span> <span class="nx">aspect</span> <span class="o">/</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
        <span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="nx">frustumSize</span> <span class="o">*</span> <span class="nx">aspect</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">frustumSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="nx">frustumSize</span> <span class="o">/</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
        <span class="nx">orthographicCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">updateProjectionMatrix</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Update camera manager with current model size if possible</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">modelRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">modelSize</span> <span class="o">=</span> <span class="nf">getModelSize</span><span class="p">();</span>
        <span class="nx">cameraStateManager</span><span class="p">.</span><span class="nf">updateModelSize</span><span class="p">(</span><span class="nx">modelSize</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">container</span><span class="p">,</span> <span class="nx">getModelSize</span><span class="p">]);</span>
</code></pre></div></div>

<p>This resize handler ensures that the renderer, cameras, and controls all adapt appropriately to size changes, maintaining proper aspect ratios and display quality.</p>

<h3 id="2-device-pixel-ratio-handling">2. Device Pixel Ratio Handling</h3>

<p>The application accounts for device pixel ratio to ensure crisp rendering on high-DPI displays:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">renderer</span><span class="p">.</span><span class="nf">setPixelRatio</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">);</span>
</code></pre></div></div>

<p>This adjustment ensures optimal visual quality on displays with varying pixel densities, such as Retina displays on Apple devices.</p>

<h3 id="3-adaptive-controls">3. Adaptive Controls</h3>

<p>The application provides different control schemes optimized for various input methods:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">controls</span><span class="p">.</span><span class="nx">mouseButtons</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">LEFT</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">ROTATE</span><span class="p">,</span>
    <span class="na">MIDDLE</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">DOLLY</span><span class="p">,</span>
    <span class="na">RIGHT</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MOUSE</span><span class="p">.</span><span class="nx">PAN</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This configuration provides intuitive controls for mouse-based interaction, while the application also supports touch interactions for mobile devices through OrbitControls’ built-in touch support.</p>

<h3 id="4-ui-adaptation">4. UI Adaptation</h3>

<p>The user interface adapts to different screen sizes:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">!</span><span class="nx">controlsVisible</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span>
        <span class="na">className</span><span class="p">=</span><span class="s">"controls-indicator"</span>
        <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setControlsVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="si">}</span>
        <span class="na">style</span><span class="p">=</span>
        <span class="na">title</span><span class="p">=</span><span class="s">"Show controls"</span>
    <span class="p">&gt;</span>
        <span class="si">{</span><span class="cm">/* Icon SVG */</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)}</span>
</code></pre></div></div>

<p>This pattern of collapsible controls allows the application to maintain usability on smaller screens where space is limited.</p>

<h3 id="5-fullscreen-support">5. Fullscreen Support</h3>

<p>The application provides fullscreen capability for an immersive experience:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">toggleFullscreen</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ViewerControlsUtils</span><span class="p">.</span><span class="nf">toggleFullscreen</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">setIsFullscreen</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">container</span><span class="p">]);</span>
</code></pre></div></div>

<p>This feature allows users to maximize screen real estate for model visualization, particularly valuable on mobile devices.</p>

<h2 id="advanced-features">Advanced Features</h2>

<h3 id="fullscreen-mode">Fullscreen Mode</h3>

<p>StructViz3D implements a robust fullscreen mode to provide an immersive visualization experience:</p>

<h4 id="1-fullscreen-toggle">1. Fullscreen Toggle</h4>

<p>The application uses the Fullscreen API for cross-browser compatibility:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Utility function in ViewerControlsUtils</span>
<span class="nf">toggleFullscreen</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">setIsFullscreen</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">container</span><span class="p">.</span><span class="nf">requestFullscreen</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`Error attempting to enable fullscreen: </span><span class="p">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nf">exitFullscreen</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This implementation attempts to enter fullscreen mode and provides error handling for cases where fullscreen might be restricted.</p>

<h4 id="2-fullscreen-state-tracking">2. Fullscreen State Tracking</h4>

<p>The application tracks the fullscreen state to update the UI accordingly:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Fullscreen change listener</span>
<span class="kd">const</span> <span class="nx">fullscreenChangeHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">setIsFullscreen</span><span class="p">(</span><span class="o">!!</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">);</span>
<span class="p">};</span>
<span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">fullscreenchange</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fullscreenChangeHandler</span><span class="p">);</span>
</code></pre></div></div>

<p>This ensures that UI elements like the fullscreen toggle button display the correct state.</p>

<h4 id="3-responsive-fullscreen-adaptation">3. Responsive Fullscreen Adaptation</h4>

<p>When entering fullscreen mode, the application adapts to the new dimensions:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The resize handler is triggered when entering/exiting fullscreen</span>
<span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">resize</span><span class="dl">'</span><span class="p">,</span> <span class="nx">handleResize</span><span class="p">);</span>
</code></pre></div></div>

<p>This ensures that the render context, camera properties, and UI layout all adjust appropriately to the fullscreen dimensions.</p>

<h4 id="4-fullscreen-button-ui">4. Fullscreen Button UI</h4>

<p>The fullscreen toggle is presented with intuitive iconography:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nt">button</span> 
    <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">toggleFullscreen</span><span class="si">}</span> 
    <span class="na">className</span><span class="p">=</span><span class="s">"control-button"</span> 
    <span class="na">title</span><span class="p">=</span><span class="si">{</span><span class="nx">isFullscreen</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Exit fullscreen</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Enter fullscreen</span><span class="dl">"</span><span class="si">}</span>
<span class="p">&gt;</span>
    <span class="si">{</span><span class="nx">isFullscreen</span> <span class="p">?</span> <span class="p">&lt;</span><span class="nc">Minimize</span> <span class="na">size</span><span class="p">=</span><span class="si">{</span><span class="mi">20</span><span class="si">}</span> <span class="p">/&gt;</span> <span class="p">:</span> <span class="p">&lt;</span><span class="nc">Maximize</span> <span class="na">size</span><span class="p">=</span><span class="si">{</span><span class="mi">20</span><span class="si">}</span> <span class="p">/&gt;</span><span class="si">}</span>
<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>This provides users with clear visual feedback about the current fullscreen state and the action that will be taken when clicking the button.</p>

<h3 id="view-presets">View Presets</h3>

<p>StructViz3D provides predefined view presets to help users quickly navigate to standard viewing angles:</p>

<h4 id="1-view-manager-implementation">1. View Manager Implementation</h4>

<p>The application includes a dedicated view manager for handling preset views:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ViewManager initialization</span>
<span class="nx">viewManager</span><span class="p">.</span><span class="nf">initialize</span><span class="p">(</span><span class="nx">cameraStateManager</span><span class="p">,</span> <span class="nx">getModelSize</span><span class="p">);</span>
</code></pre></div></div>

<p>This manager coordinates between camera positioning and model characteristics to ensure optimal views.</p>

<h4 id="2-standard-view-presets">2. Standard View Presets</h4>

<p>The application includes common engineering views:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// In ViewControls component</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">view-presets</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">front</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Front View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Front</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">back</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Back View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Back</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Left View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Left</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">right</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Right View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Right</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">top</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Top View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Top</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">bottom</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Bottom View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Bottom</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">handleViewPreset</span><span class="p">(</span><span class="dl">'</span><span class="s1">isometric</span><span class="dl">'</span><span class="p">)}</span> <span class="nx">title</span><span class="o">=</span><span class="dl">"</span><span class="s2">Isometric View</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Iso</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<p>These standard views (front, back, left, right, top, bottom, isometric) allow users to quickly examine models from conventional engineering perspectives.</p>

<h4 id="3-optimal-initial-view">3. Optimal Initial View</h4>

<p>The application automatically determines the best initial view for each model:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">setOptimalInitialView</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">model</span> <span class="o">||</span> <span class="o">!</span><span class="nx">cameraRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="nx">initialPositionSet</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">success</span> <span class="o">=</span> <span class="nx">viewManager</span><span class="p">.</span><span class="nf">setOptimalInitialView</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">cameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">setInitialPositionSet</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">initialPositionSet</span><span class="p">]);</span>
</code></pre></div></div>

<p>This ensures that models are displayed with good visibility immediately upon loading, improving user experience.</p>

<h4 id="4-smooth-view-transitions">4. Smooth View Transitions</h4>

<p>View changes include smooth animations for better spatial orientation:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// In ViewManager implementation</span>
<span class="nf">animateToPosition</span><span class="p">(</span><span class="nx">targetPosition</span><span class="p">,</span> <span class="nx">targetLookAt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">startPosition</span> <span class="o">=</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">startTarget</span> <span class="o">=</span> <span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
    
    <span class="c1">// Animation logic with easing functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>These animations help users maintain context when switching between views, enhancing the spatial understanding of the model.</p>

<h2 id="error-handling">Error Handling</h2>

<p>StructViz3D implements comprehensive error handling to ensure robustness and usability:</p>

<h3 id="1-loading-error-handling">1. Loading Error Handling</h3>

<p>The application provides clear feedback for model loading errors:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">loadSTLModel</span><span class="p">(</span>
    <span class="nx">modelUrl</span><span class="p">,</span>
    <span class="nx">scene</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">setOptimalInitialView</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="nf">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">onLoad</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">)</span> <span class="nf">onLoad</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">total</span> <span class="p">?</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">progress</span><span class="p">.</span><span class="nf">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">% loaded`</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error loading model:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">setError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to load the model. Please try again.</span><span class="dl">'</span><span class="p">);</span>
        <span class="nf">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p>This pattern ensures that loading errors are caught, logged, and presented to the user with actionable information.</p>

<h3 id="2-ui-error-states">2. UI Error States</h3>

<p>Error states are clearly communicated in the UI:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"error-message"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">error</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)}</span>
</code></pre></div></div>

<p>This provides users with immediate visibility into problems and helps them understand what went wrong.</p>

<h3 id="3-resource-existence-checks">3. Resource Existence Checks</h3>

<p>Operations on Three.js resources include existence checks to prevent errors:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="p">(</span><span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rendererRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">sceneRef</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span> <span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This defensive programming approach prevents runtime errors that could occur if resources are accessed before they’re fully initialized.</p>

<h3 id="4-error-boundaries">4. Error Boundaries</h3>

<p>Though not explicitly shown in the provided code, React error boundaries should be implemented at appropriate component levels to prevent entire application crashes due to rendering errors.</p>

<h3 id="5-api-error-handling">5. API Error Handling</h3>

<p>API interactions include error handling:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inside model loader</span>
<span class="nx">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error loading model:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">setError</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to load the model. Please try again.</span><span class="dl">'</span><span class="p">);</span>
        <span class="nf">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p>This ensures that network issues or server problems are properly handled and communicated to the user.</p>

<h2 id="extension-points">Extension Points</h2>

<p>StructViz3D is designed with extensibility in mind, providing several points for future enhancements:</p>

<h3 id="1-modular-architecture">1. Modular Architecture</h3>

<p>The application uses a component-based architecture that facilitates the addition of new features:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">ViewerControls</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">ColorSelector</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">CameraControls</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">ViewControls</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">GridControls</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">OrientationControls</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">WireframeControls</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nc">ViewerControls</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>This pattern allows new control components to be added without modifying existing functionality.</p>

<h3 id="2-manager-pattern">2. Manager Pattern</h3>

<p>The application uses manager classes to encapsulate complex functionality:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example manager usage</span>
<span class="nx">viewManager</span><span class="p">.</span><span class="nf">initialize</span><span class="p">(</span><span class="nx">cameraStateManager</span><span class="p">,</span> <span class="nx">getModelSize</span><span class="p">);</span>
<span class="nx">lightsRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">lightingManager</span><span class="p">.</span><span class="nf">setupLighting</span><span class="p">(</span><span class="nx">scene</span><span class="p">);</span>
</code></pre></div></div>

<p>This pattern provides clean interfaces for extending functionality in areas like lighting, camera control, and view management.</p>

<h3 id="3-callback-props">3. Callback Props</h3>

<p>Components accept callback functions for customizing behavior:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">ModelViewer</span>
    <span class="na">modelUrl</span><span class="p">=</span><span class="si">{</span><span class="nx">modelUrl</span><span class="si">}</span>
    <span class="na">binUrl</span><span class="p">=</span><span class="si">{</span><span class="nx">binUrl</span><span class="si">}</span>
    <span class="na">onLoad</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div></div>

<p>This pattern allows parent components to hook into key lifecycle events without modifying the component itself.</p>

<h3 id="4-custom-event-handlers">4. Custom Event Handlers</h3>

<p>The application implements custom event handlers that can be extended:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">handleZoom</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>

    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">controlsRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">currentCameraRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">container</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Custom zoom logic</span>
    <span class="c1">// ...</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">container</span><span class="p">]);</span>
</code></pre></div></div>

<p>This approach allows for sophisticated interactions that can be enhanced or modified in future versions.</p>

<h3 id="5-plugin-architecture">5. Plugin Architecture</h3>

<p>While not explicitly implemented, the modular design lends itself to a plugin architecture where additional features could be loaded dynamically.</p>

<h2 id="developer-guide">Developer Guide</h2>

<h3 id="component-structure">Component Structure</h3>

<p>StructViz3D follows a hierarchical component structure for maintainability and separation of concerns:</p>

<h4 id="1-main-application-appjsx">1. Main Application (App.jsx)</h4>

<p>The root component that manages the overall application state and navigation:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">App</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">modelUrl</span><span class="p">,</span> <span class="nx">setModelUrl</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">binUrl</span><span class="p">,</span> <span class="nx">setBinUrl</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span> <span class="nx">setIsLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">showUploadScreen</span><span class="p">,</span> <span class="nx">setShowUploadScreen</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    
    <span class="c1">// Event handlers and state management</span>
    
    <span class="k">return </span><span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
            <span class="si">{</span><span class="nx">showUploadScreen</span> <span class="p">?</span> <span class="p">(</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"upload-screen"</span><span class="p">&gt;</span>
                    <span class="si">{</span><span class="cm">/* Upload UI components */</span><span class="si">}</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">)</span> <span class="p">:</span> <span class="p">(</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"viewer-screen"</span><span class="p">&gt;</span>
                    <span class="si">{</span><span class="cm">/* Viewer UI components */</span><span class="si">}</span>
                    <span class="p">&lt;</span><span class="nc">ModelViewer</span>
                        <span class="na">modelUrl</span><span class="p">=</span><span class="si">{</span><span class="nx">modelUrl</span><span class="si">}</span>
                        <span class="na">binUrl</span><span class="p">=</span><span class="si">{</span><span class="nx">binUrl</span><span class="si">}</span>
                        <span class="na">onLoad</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="si">}</span>
                    <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">)</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This component handles the main application flow, switching between the upload and viewer interfaces.</p>

<h4 id="2-modelviewer-component">2. ModelViewer Component</h4>

<p>The core component for 3D visualization:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ModelViewer</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">modelUrl</span><span class="p">,</span> <span class="nx">binUrl</span><span class="p">,</span> <span class="nx">onLoad</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// State and refs for Three.js objects</span>
    
    <span class="c1">// Three.js initialization and cleanup</span>
    
    <span class="c1">// Event handlers for user interactions</span>
    
    <span class="k">return </span><span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"model-viewer-wrapper"</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="p">=</span><span class="si">{</span><span class="nx">setContainer</span><span class="si">}</span> <span class="na">className</span><span class="p">=</span><span class="s">"model-viewer-container"</span> <span class="p">/&gt;</span>
            
            <span class="si">{</span><span class="cm">/* Controls and UI overlays */</span><span class="si">}</span>
            <span class="si">{</span><span class="o">!</span><span class="nx">loading</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">modelUrl</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
                <span class="p">&lt;</span><span class="nc">ViewerControls</span><span class="p">&gt;</span>
                    <span class="si">{</span><span class="cm">/* Control components */</span><span class="si">}</span>
                <span class="p">&lt;/</span><span class="nc">ViewerControls</span><span class="p">&gt;</span>
            <span class="p">)</span><span class="si">}</span>
            
            <span class="si">{</span><span class="cm">/* Status indicators */</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This component encapsulates the Three.js integration and provides the main rendering functionality.</p>

<h4 id="3-control-components">3. Control Components</h4>

<p>Specialized components for different control functions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ColorSelector</code> - For model color customization</li>
  <li><code class="language-plaintext highlighter-rouge">CameraControls</code> - For switching between perspective and orthographic modes</li>
  <li><code class="language-plaintext highlighter-rouge">ViewControls</code> - For preset views and camera positioning</li>
  <li><code class="language-plaintext highlighter-rouge">GridControls</code> - For grid display options</li>
  <li><code class="language-plaintext highlighter-rouge">OrientationControls</code> - For model orientation</li>
  <li><code class="language-plaintext highlighter-rouge">WireframeControls</code> - For wireframe display options</li>
  <li><code class="language-plaintext highlighter-rouge">LightingControls</code> - For lighting adjustments</li>
</ul>

<h4 id="4-utility-managers">4. Utility Managers</h4>

<p>Specialized classes for complex functionality:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">viewManager</code> - Handles view presets and camera positioning</li>
  <li><code class="language-plaintext highlighter-rouge">cameraStateManager</code> - Manages camera modes and states</li>
  <li><code class="language-plaintext highlighter-rouge">lightingManager</code> - Handles lighting setup and configuration</li>
  <li><code class="language-plaintext highlighter-rouge">EnhancedWireframeMode</code> - Provides advanced wireframe visualization</li>
</ul>
